{#
  SINGLE TAG TEMPLATE (templates/tags/single.html)
  
  Purpose: Displays all blog posts for a specific tag
  URL: /tags/{tag-name}/
  Example: /tags/react/, /tags/python/
  
  Context Variables:
  - taxonomy: The taxonomy object (name="tags")
  - term: Current tag object with .name, .permalink, .pages
  - term.pages: Array of pages tagged with this term
  - config: Site configuration
  - lang: Current language code
  
  Features:
  - Breadcrumb navigation (Blog > Tags > {tag})
  - Lists all posts with this tag
  - Shows post metadata (date, author, reading time)
  - Displays tags for each post (for cross-navigation)
  - Card-based layout with hover effects
  
  Note: This is a standalone template for better control over
  tag page structure and metadata.
#}

{% import "macros/head.html" as macros_head %}
{% import "macros/search.html" as macros_search %}
{% import "macros/header.html" as macros_header %}
{% import "macros/footer.html" as macros_footer %}
{% import "macros/sidebar.html" as macros_sidebar %}

<!DOCTYPE html>
{{ macros_head::html_tag(config=config, lang=lang) }}
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ term.name }} - {{ taxonomy.name | capitalize }} - {{ config.title }}</title>
    <meta name="description" content="Posts tagged with {{ term.name }}">
    
    {# Include theme CSS and scripts #}
    <link rel="stylesheet" href="{{ get_url(path='css/main.css') }}">
    {% if config.extra.custom_css %}
    <link rel="stylesheet" href="{{ get_url(path=config.extra.custom_css) }}">
    {% endif %}
    
    {# Theme initialization script #}
    <script>
        (function() {
            var themeMapping = { "goyo-dark": "night", "goyo-light": "lofi" };
            var defaultColorset = "{{ config.extra.theme.colorset | default(value='dark') }}";
            var themeMap = { "dark": "goyo-dark", "light": "goyo-light" };
            var fallbackTheme = themeMap[defaultColorset] || "goyo-dark";
            var currentUserTheme = localStorage.getItem('theme') || fallbackTheme;
            var actualTheme = themeMapping[currentUserTheme] || currentUserTheme;
            document.documentElement.setAttribute("data-theme", actualTheme);
        })();
    </script>
</head>
<body>
    {{ macros_search::search(config=config) }}

    <div class="drawer lg:drawer-open">
        <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
        <div class="drawer-content flex flex-col pt-16">
            {{ macros_header::header(config=config, lang=lang) }}

            <div class="p-8 w-full flex justify-center">
                <div class="w-full max-w-7xl">
                    <main class="prose w-full">
    <div class="mb-8 pb-4 border-b border-gray-500/15">
        <div class="flex items-center gap-2 text-sm text-gray-500 mb-2">
            <a href="/blog" class="hover:text-primary">Blog</a>
            <span>/</span>
            <span>{{ taxonomy.name | capitalize }}</span>
        </div>
        <h1 class="flex items-center gap-3">
            <span class="opacity-50">#</span>{{ term.name }}
        </h1>
        <p class="text-gray-500">Showing all posts tagged with "{{ term.name }}"</p>
    </div>

    {% if term.pages %}
    <div class="grid gap-8 mt-8">
        {% for page in term.pages %}
            <article class="card bg-base-200 shadow-xl border border-gray-500/15 transition hover:border-gray-500/40">
                <div class="card-body">
                    <h2 class="card-title">
                        <a href="{{ page.permalink }}" class="hover:text-primary transition-colors">{{ page.title }}</a>
                        {% if page.extra.badge %}
                            <div class="badge badge-secondary">{{ page.extra.badge }}</div>
                        {% endif %}
                    </h2>
                    <div class="text-sm text-gray-500 mb-2 flex flex-wrap gap-2 items-center">
                        {% if page.date %}
                            <span>{{ page.date | date(format="%B %d, %Y") }}</span>
                        {% endif %}
                        
                        {% if page.extra.reading_time or page.reading_time %}
                            <span>• {{ page.extra.reading_time | default(value=page.reading_time) }} min read</span>
                        {% endif %}

                        {% if page.extra.author %}
                            <span>• by {{ page.extra.author }}</span>
                        {% endif %}
                    </div>

                    <div class="flex flex-wrap gap-2 mb-3">
                        {# Display Tags #}
                        {% if page.taxonomies.tags %}
                            {% for tag in page.taxonomies.tags %}
                                {% set tag_slug = tag | slugify %}
                                <a href="/tags/{{ tag_slug }}" class="badge badge-ghost badge-outline badge-sm hover:badge-primary transition-colors">#{{ tag }}</a>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <p class="text-base-content/80">
                        {% if page.description %}
                            {{ page.description }}
                        {% elif page.summary %}
                            {{ page.summary | safe }}
                        {% else %}
                            {{ page.content | striptags | truncate(length=200) }}
                        {% endif %}
                    </p>
                    <div class="card-actions justify-end mt-4">
                        <a href="{{ page.permalink }}" class="btn btn-primary btn-sm">Read More</a>
                    </div>
                </div>
            </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <span>No posts found in this {{ taxonomy.name }}.</span>
    </div>
    {% endif %}
                    </main>
                </div>
            </div>

            {{ macros_footer::footer(config=config, current_url=config.base_url) }}
        </div>

        {{ macros_sidebar::sidebar(config=config, lang=lang, current_path=current_path, section=false) }}
    </div>

    {# Scripts #}
    <script src="{{ get_url(path='goyo.js') }}"></script>
    {% if config.build_search_index %}
    <script src="{{ get_url(path='elasticlunr.min.js') }}"></script>
    <script src="{{ get_url(path='search_index.' ~ lang ~ '.js') }}"></script>
    {% endif %}
</body>
</html>
